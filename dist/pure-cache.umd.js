!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PureCache=t()}(this,function(){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{},n=Object.keys(i);"function"==typeof Object.getOwnPropertySymbols&&(n=n.concat(Object.getOwnPropertySymbols(i).filter(function(e){return Object.getOwnPropertyDescriptor(i,e).enumerable}))),n.forEach(function(e){a(t,e,i[e])})}return t}var u="expiry",h="add",i="get",r="remove",f="clear",l=function(e){if(e)throw new Error("This instance is already disposed. Please create new instance and try again.")},d=function(){function i(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,i),a(this,"queue",{}),a(this,"defaultConfig",{expiryCheckInterval:100}),a(this,"expire",function(){l(n.instanceDisposed);for(var e=Date.now(),t=e;t>=n.lastExpiredTime;t-=1){var i=n.queue[t];i&&(delete n.queue[t],i.forEach(function(e){var t=e.key;return(0,e.onExpire)(t)}))}n.lastExpiredTime=e}),this.config=c({},this.defaultConfig,e),this.instanceDisposed=!1,this.lastExpiredTime=Date.now()-1;var t=this.config.expiryCheckInterval;this.timer=setInterval(this.expire,t)}return e(i,[{key:"add",value:function(e,t,i){return l(this.instanceDisposed),this.queue[e]||(this.queue[e]=[]),this.queue[e].push({key:t,onExpire:i}),!0}},{key:"remove",value:function(e,t){l(this.instanceDisposed);var i=this.queue[e];if(i){var n=i.filter(function(e){return e.key!==t});return n.length?this.queue[e]=n:delete this.queue[e],!0}return!1}},{key:"dispose",value:function(){return l(this.instanceDisposed),clearInterval(this.timer),this.timer=null,this.queue={},this.instanceDisposed=!0}}]),i}();return function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,s),a(this,"cacheStore",{}),a(this,"defaultConfig",{defaultCacheExpiryIn:6e4,expiryCheckInterval:100}),this.config=c({},this.defaultConfig,e);var n,t=(n=n||Object.create(null),{on:function(e,t){(n[e]||(n[e]=[])).push(t)},off:function(e,t){n[e]&&n[e].splice(n[e].indexOf(t)>>>0,1)},emit:function(t,i){(n[t]||[]).slice().map(function(e){e(i)}),(n["*"]||[]).slice().map(function(e){e(t,i)})}}),i=[t.on,t.off,t.emit];this.on=i[0],this.off=i[1],this.emit=i[2],this.instanceDisposed=!1;var r=this.config.expiryCheckInterval;this.cacheExpirer=new d({expiryCheckInterval:r})}return e(s,[{key:"put",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.config.defaultCacheExpiryIn;l(this.instanceDisposed),this.cacheStore[t]&&this.remove(t);var r=Date.now(),s=n?r+n:null,o={value:i,addedAt:r,expiryAt:s};if(this.cacheStore[t]=o,s){this.cacheExpirer.add(s,t,function(){e.emit(u,{key:t,data:o}),e.remove(t)})}return this.emit(h,{key:t,data:o}),o}},{key:"get",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";l(this.instanceDisposed);var t=this.cacheStore[e];return t?(this.emit(i,{key:e,data:t}),t):null}},{key:"remove",value:function(e){l(this.instanceDisposed);var t=this.cacheStore[e];if(t){delete this.cacheStore[e];var i=t.expiryAt;return this.cacheExpirer.remove(i,e),this.emit(r,{key:e,data:t}),!0}return!1}},{key:"dispose",value:function(){var t=this;return l(this.instanceDisposed),Object.keys(this.cacheStore).forEach(function(e){return t.remove(e)}),this.emit(f,{}),this.cacheExpirer.dispose(),this.instanceDisposed=!0}}]),s}()});
//# sourceMappingURL=pure-cache.umd.js.map

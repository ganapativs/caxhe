!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PureCache=t()}(this,function(){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}function a(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var u="expiry",c="add",i="get",r="remove",h="clear",d=function(e){if(e)throw new Error("This instance is already disposed. Please create new instance and try again.")},s={expiryCheckInterval:100},f=function(){function i(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,i),a(this,"queue",{}),a(this,"disposed",!1),a(this,"lastExpiredTime",Date.now()-1),a(this,"expire",function(){d(n.disposed);for(var e=Date.now(),t=e;t>=n.lastExpiredTime;t-=1){var i=n.queue[t];i&&(delete n.queue[t],i.forEach(function(e){var t=e.key;return(0,e.onExpire)(t)}))}n.lastExpiredTime=e}),this.config=Object.assign({},s,e);var t=this.config.expiryCheckInterval;this.timer=setInterval(this.expire,t)}return e(i,[{key:"add",value:function(e,t,i){return d(this.disposed),this.queue[e]||(this.queue[e]=[]),this.queue[e].push({key:t,onExpire:i}),!0}},{key:"remove",value:function(e,t){d(this.disposed);var i=this.queue[e];if(i){var n=i.filter(function(e){return e.key!==t});return n.length?this.queue[e]=n:delete this.queue[e],!0}return!1}},{key:"dispose",value:function(){return d(this.disposed),clearInterval(this.timer),this.timer=null,this.queue={},this.disposed=!0}}]),i}(),l={defaultCacheExpiryIn:6e4,expiryCheckInterval:100};return function(){function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this,s),a(this,"cacheStore",{}),a(this,"disposed",!1),this.config=Object.assign({},l,e);var n,t=(n=n||Object.create(null),{on:function(e,t){(n[e]||(n[e]=[])).push(t)},off:function(e,t){n[e]&&n[e].splice(n[e].indexOf(t)>>>0,1)},emit:function(t,i){(n[t]||[]).slice().map(function(e){e(i)}),(n["*"]||[]).slice().map(function(e){e(t,i)})}}),i=[t.on,t.off,t.emit];this.on=i[0],this.off=i[1],this.emit=i[2];var r=this.config.expiryCheckInterval;this.cacheExpirer=new f({expiryCheckInterval:r})}return e(s,[{key:"put",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.config.defaultCacheExpiryIn;d(this.disposed),this.cacheStore[t]&&this.remove(t);var r=Date.now(),s=n?r+n:null,o={value:i,addedAt:r,expiryAt:s};if(this.cacheStore[t]=o,s){this.cacheExpirer.add(s,t,function(){e.emit(u,{key:t,data:o}),e.remove(t)})}return this.emit(c,{key:t,data:o}),o}},{key:"get",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";d(this.disposed);var t=this.cacheStore[e];return t?(this.emit(i,{key:e,data:t}),t):null}},{key:"remove",value:function(e){d(this.disposed);var t=this.cacheStore[e];if(t){delete this.cacheStore[e];var i=t.expiryAt;return this.cacheExpirer.remove(i,e),this.emit(r,{key:e,data:t}),!0}return!1}},{key:"dispose",value:function(){var t=this;return d(this.disposed),Object.keys(this.cacheStore).forEach(function(e){return t.remove(e)}),this.emit(h,{}),this.cacheExpirer.dispose(),this.disposed=!0}}]),s}()});
//# sourceMappingURL=pure-cache.umd.js.map

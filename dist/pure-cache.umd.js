!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.PureCache=t()}(this,function(){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function e(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}var u="expiry",h="add",i="get",r="remove",s="clear",c=function(e){if(e)throw new Error("Cannot use disposed instance.")},d={expiryCheckInterval:100},f=function(){function o(){var e,t,i,n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,o),i=function(){c(n.disposed);for(var e=Date.now(),t=e;t>=n.lastExpiredTime;t-=1){var i=n.queue[t];i&&(delete n.queue[t],i.forEach(function(e){var t=e.key;return(0,e.onExpire)(t)}))}n.lastExpiredTime=e},(t="expire")in(e=this)?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,this.config=Object.assign({},d,r),this.queue={},this.disposed=!1,this.lastExpiredTime=Date.now()-1;var s=this.config.expiryCheckInterval;this.timer=setInterval(this.expire,s)}return e(o,[{key:"add",value:function(e,t,i){return c(this.disposed),this.queue[e]||(this.queue[e]=[]),this.queue[e].push({key:t,onExpire:i}),!0}},{key:"remove",value:function(e,t){c(this.disposed);var i=this.queue[e];if(i){var n=i.filter(function(e){return e.key!==t});return n.length?this.queue[e]=n:delete this.queue[e],!0}return!1}},{key:"dispose",value:function(){return c(this.disposed),clearInterval(this.timer),this.timer=null,this.queue={},this.disposed=!0}}]),o}(),l={defaultCacheExpiryIn:6e4,expiryCheckInterval:100};return function(){function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:f;a(this,o),this.config=Object.assign({},l,e);var n,i=(n=n||Object.create(null),{on:function(e,t){(n[e]||(n[e]=[])).push(t)},off:function(e,t){n[e]&&n[e].splice(n[e].indexOf(t)>>>0,1)},emit:function(t,i){(n[t]||[]).slice().map(function(e){e(i)}),(n["*"]||[]).slice().map(function(e){e(t,i)})}}),r=[i.on,i.off,i.emit];this.on=r[0],this.off=r[1],this.emit=r[2],this.cacheStore={},this.disposed=!1;var s=this.config.expiryCheckInterval;this.cacheExpirer=new t({expiryCheckInterval:s})}return e(o,[{key:"put",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.config.defaultCacheExpiryIn;c(this.disposed),this.cacheStore[t]&&this.remove(t);var r=Date.now(),s=n?r+n:null,o={value:i,addedAt:r,expiryAt:s};if(this.cacheStore[t]=o,s){this.cacheExpirer.add(s,t,function(){e.emit(u,{key:t,data:o}),e.remove(t)})}return this.emit(h,{key:t,data:o}),o}},{key:"get",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";c(this.disposed);var t=this.cacheStore[e];return t?(this.emit(i,{key:e,data:t}),t):null}},{key:"remove",value:function(e){c(this.disposed);var t=this.cacheStore[e];if(t){delete this.cacheStore[e];var i=t.expiryAt;return this.cacheExpirer.remove(i,e),this.emit(r,{key:e,data:t}),!0}return!1}},{key:"dispose",value:function(){var t=this;return c(this.disposed),Object.keys(this.cacheStore).forEach(function(e){return t.remove(e)}),this.emit(s,{}),this.cacheExpirer.dispose(),this.disposed=!0}}]),o}()});
//# sourceMappingURL=pure-cache.umd.js.map
